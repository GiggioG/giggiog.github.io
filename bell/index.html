<!DOCTYPE html>
<html lang="en">

<head>
    <base href="..">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The bell</title>
    <link href="./img/logo.png" rel="shortcut icon">
    <i class="incl-fonts"></i>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://kit.fontawesome.com/ad53433535.js" crossorigin="anonymous"></script>
    <script src="./js/includes.js"
        data-includes="navbar,./includes/nav.html|fonts,./includes/fonts.html|byme,./includes/meme_by_me.html"></script>
</head>

<body>
    <i class="incl-navbar"></i>
    <main>
        <h1 class="primary-text" id="title"></h1>
        <h2 class="secondary-text" id="time"></h2>
    </main>
    <script>
        class Event{
            constructor(beg,end,name){
                this.beg=beg;
                this.end=end;
                this.name=name;
            }
            in(time){
                if((time > this.beg) && (time < this.end)){
                    return true;
                }
                return false;
            }
        }
        let etitle = document.getElementById("title");
        let etime = document.getElementById("time");
        let time;
        let programa = [
            new Event(34200, 36599,"class"),new Event(36600, 37199,"break"),
            new Event(37200, 39599,"class"),new Event(39600, 40799,"break"),
            new Event(40800, 43199,"class"),new Event(43200, 43799,"break"),
            new Event(43800, 46199,"class")
        ];
        setInterval(_ => {
            let date = new Date();
            time = (date.getHours() * 3600) + (date.getMinutes() * 60) + (date.getSeconds() * 1);
            if((date.getDay() == 6) || (date.getDay() == 7)){
                out(((8-date.getDay())*86400) + programa[0].beg,"Time until school", true);
                return;
            }
            if (time < programa[0].beg) {
                out(programa[0].beg - time, "Time until school", true);
                return;
            }
            if (time > programa[programa.length - 1].end) {
                let otp = (86400-time)+programa[0].beg;
                if(date.getDay() == 5){
                    time += (86400*2);
                }
                out(otp, "Time until school",true);
                return;
            }
            let idx;
            programa.forEach((e,i)=>{
                if(e.in(time)){
                    idx = i;
                }
            });
            out(programa[idx].end-time, `Time untill end of ${programa[idx].name}.`, (programa[idx].name=="break"?true:false));
        }, 300)
        let out = (sec, title, green) => {
            etitle.innerHTML = title;
            let day = Math.floor(sec / (24 * 3600));
            sec = sec % (24 * 3600);
            let hour = Math.floor(sec / 3600);
            sec %= 3600;
            let minutes = Math.floor(sec / 60 );
            sec %= 60;
            let seconds = sec;
            etime.innerHTML = `${day}:${hour}:${minutes}:${seconds}`;
            if(green){
                document.body.style.backgroundColor = "lightgreen";
            }else{
                document.body.style.backgroundColor = "lightsalmon";
            }
        }
    </script>
</body>

</html>